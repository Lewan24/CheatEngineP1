@using System.ComponentModel.DataAnnotations
@using CheatEngineP1.Entities
@using CheatEngineP1.Interfaces

@inject ISnackbar SnackBar
@inject IProcessMemoryWriter CheatWriterService

<MudDialog>
    <DialogContent>
        <EditForm Model="@_changePointerModel" OnValidSubmit="Submit">
            <DataAnnotationsValidator/>
            
            <MudTextField @bind-Value="@_changePointerModel.NewValue" T="int" For="@(() => _changePointerModel.NewValue)" Label="New Value"
                          InputMode="InputMode.numeric" InputType="InputType.Number"/>

            <MudButton Color="Color.Success" Variant="Variant.Filled" ButtonType="ButtonType.Submit">Save</MudButton>
        </EditForm>
    </DialogContent>
    
    <DialogActions>
        <MudButton OnClick="@Cancel">Close</MudButton>
    </DialogActions>
</MudDialog>

@code{
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = null!;
    
    [Parameter] public ProcessMemoryPointerPath? Pointer { get; set; }
    [Parameter] public long? PointerShift { get; set; }

    private ChangePointerValueModel _changePointerModel = new();
    
    private void Submit()
    {
        try
        {
            CheatWriterService.WritePointerValue(Pointer!, PointerShift, _changePointerModel.NewValue);
            
            MudDialog.Close(DialogResult.Ok(true));
        }
        catch (Exception e)
        {
            SnackBar.Add(e.Message, Severity.Error);
        }
    }

    private void Cancel()
        => MudDialog.Cancel();

    private record ChangePointerValueModel
    {
        [Required]
        [Range(1, 10000)]
        public int NewValue { get; set; }
    }
}